<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/admin-layout :: layout(~{::title}, ~{::mainContent})}">
<head>
  <title>Quản Lý Máy Tính</title>
  <meta charset="utf-8">
</head>
<body>
<main th:fragment="mainContent">
  <h2 class="section-title">Danh Sách Máy Tính</h2>
  <a th:href="@{/admin/computers/add}" class="btn-add">Thêm Máy Tính Mới</a>
  <table>
    <thead>
    <tr>
      <th>Mã Máy</th>
      <th>Tên Máy</th>
      <th>Loại Máy</th>
      <th>Trạng Thái</th>
      <th>Hành Động</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="may : ${danhSachMayTinh}">
      <td th:text="${may.maMay}">MT01</td>
      <td th:text="${may.tenMay}">Máy 01</td>
      <td th:text="${may.loaiMay != null ? may.loaiMay.maLoaiMay : 'N/A'}">VIP</td>
      <td th:text="${may.trangThai}">Khả dụng</td>
      <td class="action-buttons">
        <a th:href="@{/admin/computers/edit/{maMay}(maMay=${may.maMay})}" class="btn-edit">Sửa</a>
        <button class="btn-delete" th:attr="onclick=|deleteComputer('${may.maMay}')|">Xóa</button>
      </td>
    </tr>
    <tr th:if="${#lists.isEmpty(danhSachMayTinh)}">
      <td colspan="5" style="text-align: center;">Không có máy tính nào.</td>
    </tr>
    </tbody>
  </table>
  <script>
    function deleteComputer(maMay) {
        if (confirm('Bạn có chắc chắn muốn xóa máy ' + maMay + '?')) {
            fetch('/api/manager/computers/' + maMay, { // Gọi API DELETE của ManagerController
                method: 'DELETE',
                headers: {
                    // 'Authorization': 'Bearer ' + yourAuthToken, // Nếu API yêu cầu token
                    // '_csrf_token': yourCsrfToken // Nếu dùng CSRF protection
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Xóa máy ' + maMay + ' thành công!');
                    window.location.reload(); // Tải lại trang
                } else {
                    response.text().then(text => alert('Lỗi khi xóa máy: ' + text));
                }
            })
            .catch(error => console.error('Lỗi:', error));
        }
    }
  </script>
</main>
</body>
</html>