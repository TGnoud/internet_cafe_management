<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quản Lý Máy Tính</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Custom CSS */
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>Quản Lý Máy Tính</h2>

    <div th:if="${param.success}" class="alert alert-success">Thao tác thành công!</div>
    <div th:if="${param.error}" class="alert alert-danger">Có lỗi xảy ra!</div>

    <h4>Thêm Máy Tính Mới (Ví dụ với Thymeleaf form)</h4>
    <form th:action="@{/admin/pages/computers/add}" th:object="${newComputer}" method="post" class="mb-4">
        <div class="form-group">
            <label for="maMay">Mã Máy:</label>
            <input type="text" th:field="*{maMay}" class="form-control" id="maMay" required/>
        </div>
        <div class="form-group">
            <label for="tenMay">Tên Máy:</label>
            <input type="text" th:field="*{tenMay}" class="form-control" id="tenMay" required/>
        </div>
        <div class="form-group">
            <label for="trangThai">Trạng Thái:</label>
            <input type="text" th:field="*{trangThai}" class="form-control" id="trangThai"/>
        </div>
        <button type="submit" class="btn btn-primary">Thêm Máy</button>
    </form>

    <hr/>

    <h4>Danh Sách Máy Tính</h4>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Mã Máy</th>
            <th>Tên Máy</th>
            <th>Loại Máy</th>
            <th>Trạng Thái</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="computer : ${computers}">
            <td th:text="${computer.maMay}"></td>
            <td th:text="${computer.tenMay}"></td>
            <td th:text="${computer.loaiMay != null ? computer.loaiMay.maLoaiMay : 'N/A'}"></td>
            <td th:text="${computer.trangThai}"></td>
            <td>
                <button th:onclick="'editComputer(\'' + ${computer.maMay} + '\')'" class="btn btn-sm btn-warning">Sửa</button>
                <button th:onclick="'deleteComputer(\'' + ${computer.maMay} + '\')'" class="btn btn-sm btn-danger">Xóa</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    // JavaScript để gọi API cho việc Sửa/Xóa
    // Ví dụ:
    function editComputer(maMay) {
        // Hiển thị modal, load dữ liệu máy tính bằng API GET /api/manager/computers/{maMay}
        // Điền vào form trong modal
        // Submit form trong modal bằng API PUT /api/manager/computers/{maMay}
        console.log("Sửa máy: " + maMay);
        // window.location.href = '/admin/pages/computers/edit/' + maMay; // Hoặc cách khác
    }

    async function deleteComputer(maMay) {
        if (confirm('Bạn có chắc chắn muốn xóa máy ' + maMay + '?')) {
            try {
                const response = await fetch(`/api/manager/computers/${maMay}`, { // Gọi REST API đã tạo
                    method: 'DELETE',
                    headers: {
                        // 'Authorization': 'Bearer YOUR_JWT_TOKEN', // Nếu có security
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    alert('Xóa máy thành công!');
                    window.location.reload(); // Tải lại trang
                } else {
                    const errorData = await response.json();
                    alert('Lỗi khi xóa máy: ' + (errorData.message || response.statusText));
                }
            } catch (error) {
                console.error('Lỗi:', error);
                alert('Đã xảy ra lỗi không mong muốn.');
            }
        }
    }
</script>
</body>
</html>